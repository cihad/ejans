<% page_name = @notification.title %>
<% title page_name %>

<% meta_description @notification.sms %>

<article>
  <%#= current_account.subscription(@notification.service).notice(@notification).update_attributes(:new => false, :read => true) if account_signed_in? && current_account.subscribing?(@notification.service) %>
  <%= content_tag :h1, page_name %>

  <% @notification.services_notifications.each do |sn| %>
    <ul class="selections-list">
      <li class="service"><%= link_to sn.service.title, [sn.service] %></li>
      <% sn.selections.each do |selection| %>
        <% if account_signed_in? and
              current_account.subscribing?(sn.service) and
              current_account.subscription(sn.service).selections.include?(selection) %>
          <li class="selection active" data-original-title='<%= t('.selected') %>'>
            <%= selection.label %>
            <span>âœ“</span>
          </li>
        <% else %>
          <li class="selection"><%= selection.label %></li>
        <% end %>
      <% end %>
      <li id="more"><span>+</span></li>
    </ul>
  <% end %>
  
  <%= format_desc @notification.description %>
</article>

<%= javascript_tag do %>
jQuery(function($) {
  var visible = 5, $lis = $('.selection'), listlength = $lis.length, $more = $('#more');

  function showUpToIndex(selections, index) {
    selections.hide();
    selections.slice(0, index).show();
  }

  $('.selections-list').each(function(i) {
    var $selections = $(this).find('.selection') ,listlength = $selections.length, $more = $('#more', this)
    if(visible >= listlength) $more.hide();
    showUpToIndex($selections, visible);  
    $more.toggle(
      function () {
        showUpToIndex($selections, listlength);
      },
      function () {
        showUpToIndex($selections, visible);
      }
    );

  });
});
<% end %>


<table class="statics-table small">
  <tbody><tr>
    <td>
      <div class="count">
        <span><%= @notification.created_at.strftime("%d.%m.%Y")  %></span>
      </div>
      <div class="desc">
        <span><%= t('.created_at') %></span>
      </div>
    </td>

    <td>
      <div class="count">
        <%= @notification.notificationable.email.split("@")[0] if @notification.notificationable_type == "Account" %>
      </div>
      <div class="desc">
        <%= t('.author') %>
      </div>
    </td>

    <td>
      <div class="count">
        0 <!-- goal -->
      </div>
      <div class="desc">
        <%= t('.read') %>
      </div>
    </td>
  </tr>
</tbody></table>

<div id="comments">
  <h3><%= t('comments.comment_title') %></h3>
  <div class="comments-ins">
    <%= render @comments %>
  </div>
</div>

<% if account_signed_in? %>
  <%= render 'comments/form', :notification => @notification %>
<% else %>
  <div class="row comment"><div class="span6 offset2"><%= t('comments.signin_html') %></div></div>
<% end %>

<%= link_to t('global.edit'), edit_service_notification_path(@service, @notification) %> |
<%= link_to t('global.back'), @service %>

<script>
$(function () {
  $('.active').tooltip('hide')
})
</script>